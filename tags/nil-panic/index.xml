<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Nil Panic on Neal&#39;s Blog</title>
    <link>https://madneal.com/tags/nil-panic/</link>
    <description>Recent content in Nil Panic on Neal&#39;s Blog</description>
    <generator>Hugo</generator>
    <language>en</language>
    <copyright>© This post is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License，please give source if you wish to quote or reproduce.</copyright>
    <lastBuildDate>Sat, 30 Nov 2024 00:00:00 +0000</lastBuildDate>
    <atom:link href="https://madneal.com/tags/nil-panic/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>NilAway：实用的 Go Nil Panic 检测方式</title>
      <link>https://madneal.com/post/nilayay/</link>
      <pubDate>Sat, 30 Nov 2024 00:00:00 +0000</pubDate>
      <guid>https://madneal.com/post/nilayay/</guid>
      <description>&lt;blockquote&gt;&#xA;&lt;p&gt;原文：&lt;a href=&#34;https://www.uber.com/en-NL/blog/nilaway-practical-nil-panic-detection-for-go/&#34;&gt;NilAway: Practical Nil Panic Detection for Go&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;译者：&lt;a href=&#34;https://github.com/madneal&#34;&gt;madneal&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;welcome to star my &lt;a href=&#34;https://github.com/madneal/articles-translator/&#34;&gt;articles-translator&lt;/a&gt;, providing you advanced articles translation. Any suggestion, please issue or contact &lt;a href=&#34;mailto:bing.ecnu@gmail.com&#34;&gt;me&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;LICENSE: &lt;a href=&#34;https://opensource.org/licenses/MIT&#34;&gt;MIT&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://blog.uber-cdn.com/cdn-cgi/image/width=2048,quality=80,onerror=redirect,format=auto/wp-content/uploads/2023/11/cover_photo.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;&#xA;&lt;p&gt;Uber 由于 &lt;a href=&#34;https://go.dev/?uclick_id=6f537554-73b3-4559-9cd3-4ce624452b1f&#34;&gt;Go&lt;/a&gt; 语言的&lt;a href=&#34;https://www.uber.com/blog/tech-stack-part-one-foundation/?uclick_id=6f537554-73b3-4559-9cd3-4ce624452b1f&#34;&gt;高性能&lt;/a&gt;，广泛采用其作为实现后端服务和库的主要编程语言。Uber 的 &lt;a href=&#34;https://www.uber.com/blog/go-monorepo-bazel/?uclick_id=6f537554-73b3-4559-9cd3-4ce624452b1f&#34;&gt;Go monorepo&lt;/a&gt; 是 Uber 最大的代码库，包含 9000 万行代码（并且还在增长）。这使得编写可靠 Go 代码的工具成为我们开发基础设施的重要组成部分。&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.golang-book.com/books/intro/8?uclick_id=6f537554-73b3-4559-9cd3-4ce624452b1f&#34;&gt;指针&lt;/a&gt;（保存其他变量的内存地址而不是其实际值的变量）是 Go 编程语言的一个重要组成部分，有助于高效的内存管理和有效的数据操作。因此，程序员在编写 Go 程序时广泛使用指针，出于多种目的，如原地数据修改、并发编程、数据共享优化、内存使用优化以及支持接口和多态性。虽然指针功能强大且被广泛使用，但必须谨慎和明智地使用它们，以避免诸如空指针解引用导致的 nil panic 等常见陷阱。&lt;/p&gt;&#xA;&lt;h2 id=&#34;nil-panic-问题&#34;&gt;nil panic 问题&lt;/h2&gt;&#xA;&lt;p&gt;nil panic 是指程序尝试解引用一个 nil 指针时发生的运行时 panic。当一个指针为 nil 时，意味着它不指向任何有效的内存地址，尝试访问它指向的值将导致 panic（即运行时错误），错误信息如图 1 所示。&lt;/p&gt;&#xA;&lt;p&gt;&lt;img src=&#34;https://blog.uber-cdn.com/cdn-cgi/image/width=2048,quality=80,onerror=redirect,format=auto/wp-content/uploads/2023/11/figure_1.jpg&#34; alt=&#34;&#34;&gt;&lt;/p&gt;&#xA;&lt;!-- raw HTML omitted --&gt;&#xA;&lt;p&gt;图 2 显示了在实现 Go 标准库（特别是 &lt;em&gt;net&lt;/em&gt; 包）中发现并解决的最近一次 &lt;a href=&#34;https://github.com/golang/go/pull/60823?uclick_id=6f537554-73b3-4559-9cd3-4ce624452b1f&#34;&gt;nil panic 问题&lt;/a&gt; 的示例。由于在第 1859 行直接调用了方法 &lt;em&gt;RemoteAddr()&lt;/em&gt; 的返回值上的 &lt;em&gt;String()&lt;/em&gt; 方法，假设它总是非 nil 的，如图2所示，从而引发了 panic。当接口类型 &lt;em&gt;net.Conn&lt;/em&gt; 的字段 &lt;em&gt;c.rwc&lt;/em&gt; 被分配给结构 &lt;em&gt;net.conn&lt;/em&gt; 时导致了这个问题，因为如果发现连接 c 异常的话，它的 &lt;em&gt;RemoteAddr()&lt;/em&gt; 的具体实现可以返回 nil 值（如图 3 所示）。具体来说，&lt;em&gt;RemoteAddr()&lt;/em&gt; 可以在 L225 返回一个 &lt;a href=&#34;https://go.dev/tour/methods/13?uclick_id=6f537554-73b3-4559-9cd3-4ce624452b1f#:~:text=A%20nil%20interface%20value%20holds,which%20concrete%20method%20to%20call.&#34;&gt;nil 接口值&lt;/a&gt;，当被调用方法（&lt;em&gt;.String()&lt;/em&gt;）时，由于 &lt;em&gt;nil&lt;/em&gt; 值不包含任何指向可以调用的具体方法的指针，从而导致 nil panic。&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
